After generating raw sequences filtered only around indels (3-base filter), for the Drosophila Genome Nexus (DGN) we performed additional filtering of heterozygosity and identity-by-descent regions. Below, we describe these filters in detail and describe the provided scripts that can be used to perform this filtering.

HETEROZYGOSITY FILTERING
For diploid genomes (i.e., the DGRP genomes from Raleigh), we masked all heterozygous tracts. We scanned the 5 euchromatic arms of each diploid genome for heterozygous calls in 100 kb windows advancing in 5 kb increments. Rather than use a hard boundary for delineating windows of residual heterozygosity, we chose to scale the threshold for a given window to the level of genetic diversity observed in that window within either sub-Saharan or cosmopolitan populations, depending on the geographic origin of each individual genome. To determine these thresholds, we estimated nucleotide diversity (π) in 100 kb windows advancing in 5 kb increments for the large Rwandan (RG) sample of 27 haploid embryo genomes and the French sample of 9 haploid embryo genomes to represent sub-Saharan and cosmopolitan diversity, respectively. Then to scan each genome for heterozygosity, whenever the proportion of heterozygous sites in a given window exceeded π/5, a masking interval was initiated, and this interval was extended in both directions on the chromosome arm until encountering a window with heterozygosity less than π/20.
	To perform this filtering, place the heterozygosity_windows.pl script in the same directory as your gzipped target *sites.vcf.gz files and execute. This will output heterozygosity in windows suitable for the heterozygosity_to_filter.pl to examine for tracts that excede the above described thresholds. To identify these tracts, the FR_pi.txt and RG_pi.txt files should be placed in the same directory as the HetRegions.txt inputs. These *_pi.txt files contain the cosmopolitan (FR_pi.txt) and African (RG_pi.txt) pi threshold windows. For cosmopolitan genomes, $thresh should be set to FR_pi.txt, whereas if the genomes are sub-Saharan African, $thresh should be set to RG_pi.txt. In addition, the objects in the @Chromosome array should be edited to match the reference contigs you wish to examine. Then, execute the heterozygosity_to_filter.pl script. Sequence ranges that excede the designated thresholds will be identified in the *HetFilterTracts.txt files that are produced.

PSEUDOHETEROZYGOSITY FILTERING
While haploid embryo genomes are not expected to contain any true heterozygosity, repetitive and/or duplicated regions can cause mismapping that results in tracts of “pseudoheterozygosity”. To detect these tracts and remove them, we implemented the same threshold approach as outlined above (without normalization, since none of these genomes showed elevated background levels of putative heterozygosity). For these genomes, the Unified Genotyper was run in haploid mode, and so read proportions were analyzed in place of called heterozygous sites. For windows with the proportion of sites with <75% of the reads matching the consensus base above π/5, that window was enucleated, and this window was extended in both directions until encountering a window below π/20.
	To perform the pseudoheterozygosity filtering, the approach is the same as outlined above for true heterozygosity, with the exception of using haploid *sites.vcf.gz files as inputs, and utilizing the pseudoheterozygosity_windows.pl script to generate "heterozygosity" windows.

IDENTITY-BY-DESCENT FILTERING
Tracts of IBD may reflect the sampling of related individuals, and can contradict theoretical assumptions and complicate many population genetic analyses. To identify tracts of IBD, we implemented the approach of Pool et al. (2012), but with slight modifications for the diploid genomes and for the large DPGP3 population sample (described below). All possible pairwise comparisons were made for each of the five euchromatic arms of each genome, and pairwise differences per site were calculated in 500 kb windows advanced in 100 kb increments. Windows with less than 0.0005 pairwise differences per site were deemed putatively IBD. Some chromosomal intervals (including centromere- and telomere-proximal regions) exhibited large-scale, recurrent IBD between populations suggesting explanations other than close relatedness, and therefore did not contribute to a genome’s IBD total unless they extended outside these recurrent IBD regions. Elsewhere, within population IBD (presumably due to very recent common ancestry) was determined to be that which totaled genome-wide >5 Mb for a pairwise comparison of genomes.
	For the DPGP2 and AGES genomes, we excluded the same recurrent IBD regions as those of Pool et al. (2012). However, for the much larger DGRP and DPGP3 samples of genomes, we visually reexamined these recurrent IBD tracts and generated new regions to be excluded for each of these data sets (provided in Table S4 of the DGN manuscript and available at http://johnpool.net/genomes.html). 
	Due to heterozygosity filtering, some diploid genomes had genomic coverages far less than the typical ~111 Mb. Therefore, the genome-wide threshold for IBD filtering was adjusted to 5% of all called positions rather than 5 Mb. In addition, only 500 kb windows with >100 kb pairwise comparisons were allowed to contribute to the 5% total, minimizing the influence of windows with large numbers of masked sites.
	
The perl script requires the
Parallel::Forkmanager module, the c++ program is pretty
straightforward and should not require anything besides g++ to compile
('g++ -o find_ibd_regions find_ibd_regions.cpp')

Pool, J. E., R. B. Corbett-Detig, R. P. Sugino, K. A. Stevens, C. M. Cardeno et al., 2012  Population genomics of Sub-Saharan Drosophila melanogaster: African diversity and 
